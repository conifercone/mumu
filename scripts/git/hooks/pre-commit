#!/bin/sh

# è·å–æ‰€æœ‰è¢«æš‚å­˜çš„æ–‡ä»¶
changed_files=$(git diff --cached --name-only)

# è¿‡æ»¤å‡º Javaã€Kotlinæ–‡ä»¶
java_files=$(echo "$changed_files" | grep '\.java$')
kotlin_files=$(echo "$changed_files" | grep '\.kt$')

# åˆå§‹åŒ–æ ‡å¿—
update_license_needed=0

# æ£€æŸ¥æ˜¯å¦éœ€è¦æ£€æŸ¥license
if [ ! -z "$java_files" ]; then
    update_license_needed=1
fi

# æ£€æŸ¥æ˜¯å¦éœ€è¦æ£€æŸ¥license
if [ ! -z "$kotlin_files" ]; then
    update_license_needed=1
fi

# å¦‚æœæ²¡æœ‰æ–‡ä»¶éœ€è¦æ£€æŸ¥ï¼Œç›´æ¥é€€å‡º
if [ [ $update_license_needed -eq 0 ]; then
    echo "â˜€ï¸ No relevant files changed, skipping Update license."
    exit 0
fi

if [ $update_license_needed -eq 1 ]; then
  echo "ğŸ¦‰ Running Update license on changed Java or Kotlin files..."
  # æ‰§è¡Œupdate_licenseè„šæœ¬
  ./update_license.sh
  # æš‚å­˜å˜æ›´
  git add .
  echo "ğŸ‰ License updated."
fi
